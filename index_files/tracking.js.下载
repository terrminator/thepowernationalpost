!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).AudienceTracking=e()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function r(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function c(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,c)}s((n=n.apply(t,e||[])).next())})}function n(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function o(t,e){return t===e||t!=t&&e!=e}function i(t,e){for(var r=t.length;r--;)if(o(t[r][0],e))return r;return-1}!function(t){var e=t.getElementsByTagName("script");"currentScript"in t||Object.defineProperty(t,"currentScript",{get:function(){try{throw new Error}catch(n){var t,r=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(n.stack)||[!1])[1];for(t in e)if(e[t].src==r||"interactive"==e[t].readyState)return e[t];return null}}})}(document);var a=Array.prototype.splice;function c(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}c.prototype.clear=function(){this.__data__=[],this.size=0},c.prototype.delete=function(t){var e=this.__data__,r=i(e,t);return!(r<0||(r==e.length-1?e.pop():a.call(e,r,1),--this.size,0))},c.prototype.get=function(t){var e=this.__data__,r=i(e,t);return r<0?void 0:e[r][1]},c.prototype.has=function(t){return i(this.__data__,t)>-1},c.prototype.set=function(t,e){var r=this.__data__,n=i(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var s="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,l=s||u||Function("return this")(),p=l.Symbol,f=Object.prototype,d=f.hasOwnProperty,b=f.toString,m=p?p.toStringTag:void 0;var g=Object.prototype.toString;var y="[object Null]",h="[object Undefined]",v=p?p.toStringTag:void 0;function x(t){return null==t?void 0===t?h:y:v&&v in Object(t)?function(t){var e=d.call(t,m),r=t[m];try{t[m]=void 0;var n=!0}catch(t){}var o=b.call(t);return n&&(e?t[m]=r:delete t[m]),o}(t):function(t){return g.call(t)}(t)}function k(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var w="[object AsyncFunction]",_="[object Function]",j="[object GeneratorFunction]",O="[object Proxy]";function S(t){if(!k(t))return!1;var e=x(t);return e==_||e==j||e==w||e==O}var I,E=l["__core-js_shared__"],C=(I=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||""))?"Symbol(src)_1."+I:"";var A=Function.prototype.toString;var U=/^\[object .+?Constructor\]$/,P=Function.prototype,z=Object.prototype,F=P.toString,L=z.hasOwnProperty,R=RegExp("^"+F.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function T(t){return!(!k(t)||(e=t,C&&C in e))&&(S(t)?R:U).test(function(t){if(null!=t){try{return A.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function N(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return T(r)?r:void 0}var q=N(l,"Map"),V=N(Object,"create");var B="__lodash_hash_undefined__",$=Object.prototype.hasOwnProperty;var M=Object.prototype.hasOwnProperty;var D="__lodash_hash_undefined__";function W(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function J(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function H(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}W.prototype.clear=function(){this.__data__=V?V(null):{},this.size=0},W.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},W.prototype.get=function(t){var e=this.__data__;if(V){var r=e[t];return r===B?void 0:r}return $.call(e,t)?e[t]:void 0},W.prototype.has=function(t){var e=this.__data__;return V?void 0!==e[t]:M.call(e,t)},W.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=V&&void 0===e?D:e,this},H.prototype.clear=function(){this.size=0,this.__data__={hash:new W,map:new(q||c),string:new W}},H.prototype.delete=function(t){var e=J(this,t).delete(t);return this.size-=e?1:0,e},H.prototype.get=function(t){return J(this,t).get(t)},H.prototype.has=function(t){return J(this,t).has(t)},H.prototype.set=function(t,e){var r=J(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var G=200;function X(t){var e=this.__data__=new c(t);this.size=e.size}X.prototype.clear=function(){this.__data__=new c,this.size=0},X.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},X.prototype.get=function(t){return this.__data__.get(t)},X.prototype.has=function(t){return this.__data__.has(t)},X.prototype.set=function(t,e){var r=this.__data__;if(r instanceof c){var n=r.__data__;if(!q||n.length<G-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new H(n)}return r.set(t,e),this.size=r.size,this};var K=function(){try{var t=N(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function Q(t,e,r){"__proto__"==e&&K?K(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function Y(t,e,r){(void 0===r||o(t[e],r))&&(void 0!==r||e in t)||Q(t,e,r)}var Z,tt=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),a=i.length;a--;){var c=i[Z?a:++n];if(!1===e(o[c],c,o))break}return t},et="object"==typeof exports&&exports&&!exports.nodeType&&exports,rt=et&&"object"==typeof module&&module&&!module.nodeType&&module,nt=rt&&rt.exports===et?l.Buffer:void 0,ot=nt?nt.allocUnsafe:void 0;var it=l.Uint8Array;function at(t,e){var r,n,o=e?(r=t.buffer,n=new r.constructor(r.byteLength),new it(n).set(new it(r)),n):t.buffer;return new t.constructor(o,t.byteOffset,t.length)}var ct=Object.create,st=function(){function t(){}return function(e){if(!k(e))return{};if(ct)return ct(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var ut,lt,pt=(ut=Object.getPrototypeOf,lt=Object,function(t){return ut(lt(t))}),ft=Object.prototype;function dt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ft)}function bt(t){return null!=t&&"object"==typeof t}var mt="[object Arguments]";function gt(t){return bt(t)&&x(t)==mt}var yt=Object.prototype,ht=yt.hasOwnProperty,vt=yt.propertyIsEnumerable,xt=gt(function(){return arguments}())?gt:function(t){return bt(t)&&ht.call(t,"callee")&&!vt.call(t,"callee")},kt=Array.isArray,wt=9007199254740991;function _t(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=wt}function jt(t){return null!=t&&_t(t.length)&&!S(t)}var Ot="object"==typeof exports&&exports&&!exports.nodeType&&exports,St=Ot&&"object"==typeof module&&module&&!module.nodeType&&module,It=St&&St.exports===Ot?l.Buffer:void 0,Et=(It?It.isBuffer:void 0)||function(){return!1},Ct="[object Object]",At=Function.prototype,Ut=Object.prototype,Pt=At.toString,zt=Ut.hasOwnProperty,Ft=Pt.call(Object);var Lt={};Lt["[object Float32Array]"]=Lt["[object Float64Array]"]=Lt["[object Int8Array]"]=Lt["[object Int16Array]"]=Lt["[object Int32Array]"]=Lt["[object Uint8Array]"]=Lt["[object Uint8ClampedArray]"]=Lt["[object Uint16Array]"]=Lt["[object Uint32Array]"]=!0,Lt["[object Arguments]"]=Lt["[object Array]"]=Lt["[object ArrayBuffer]"]=Lt["[object Boolean]"]=Lt["[object DataView]"]=Lt["[object Date]"]=Lt["[object Error]"]=Lt["[object Function]"]=Lt["[object Map]"]=Lt["[object Number]"]=Lt["[object Object]"]=Lt["[object RegExp]"]=Lt["[object Set]"]=Lt["[object String]"]=Lt["[object WeakMap]"]=!1;var Rt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Tt=Rt&&"object"==typeof module&&module&&!module.nodeType&&module,Nt=Tt&&Tt.exports===Rt&&s.process,qt=function(){try{var t=Tt&&Tt.require&&Tt.require("util").types;return t||Nt&&Nt.binding&&Nt.binding("util")}catch(t){}}(),Vt=qt&&qt.isTypedArray,Bt=Vt?function(t){return function(e){return t(e)}}(Vt):function(t){return bt(t)&&_t(t.length)&&!!Lt[x(t)]};function $t(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Mt=Object.prototype.hasOwnProperty;function Dt(t,e,r){var n=t[e];Mt.call(t,e)&&o(n,r)&&(void 0!==r||e in t)||Q(t,e,r)}var Wt=9007199254740991,Jt=/^(?:0|[1-9]\d*)$/;function Ht(t,e){var r=typeof t;return!!(e=null==e?Wt:e)&&("number"==r||"symbol"!=r&&Jt.test(t))&&t>-1&&t%1==0&&t<e}var Gt=Object.prototype.hasOwnProperty;function Xt(t,e){var r=kt(t),n=!r&&xt(t),o=!r&&!n&&Et(t),i=!r&&!n&&!o&&Bt(t),a=r||n||o||i,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var u in t)!e&&!Gt.call(t,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ht(u,s))||c.push(u);return c}var Kt=Object.prototype.hasOwnProperty;function Qt(t){if(!k(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=dt(t),r=[];for(var n in t)("constructor"!=n||!e&&Kt.call(t,n))&&r.push(n);return r}function Yt(t){return jt(t)?Xt(t,!0):Qt(t)}function Zt(t){return function(t,e,r,n){var o=!r;r||(r={});for(var i=-1,a=e.length;++i<a;){var c=e[i],s=n?n(r[c],t[c],c,r,t):void 0;void 0===s&&(s=t[c]),o?Q(r,c,s):Dt(r,c,s)}return r}(t,Yt(t))}function te(t,e,r,n,o,i,a){var c=$t(t,r),s=$t(e,r),u=a.get(s);if(u)Y(t,r,u);else{var l,p=i?i(c,s,r+"",t,e,a):void 0,f=void 0===p;if(f){var d=kt(s),b=!d&&Et(s),m=!d&&!b&&Bt(s);p=s,d||b||m?kt(c)?p=c:bt(l=c)&&jt(l)?p=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}(c):b?(f=!1,p=function(t,e){if(e)return t.slice();var r=t.length,n=ot?ot(r):new t.constructor(r);return t.copy(n),n}(s,!0)):m?(f=!1,p=at(s,!0)):p=[]:function(t){if(!bt(t)||x(t)!=Ct)return!1;var e=pt(t);if(null===e)return!0;var r=zt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Pt.call(r)==Ft}(s)||xt(s)?(p=c,xt(c)?p=Zt(c):k(c)&&!S(c)||(p=function(t){return"function"!=typeof t.constructor||dt(t)?{}:st(pt(t))}(s))):f=!1}f&&(a.set(s,p),o(p,s,n,i,a),a.delete(s)),Y(t,r,p)}}function ee(t,e,r,n,o){t!==e&&tt(e,function(i,a){if(o||(o=new X),k(i))te(t,e,a,r,ee,n,o);else{var c=n?n($t(t,a),i,a+"",t,e,o):void 0;void 0===c&&(c=i),Y(t,a,c)}},Yt)}function re(t){return t}var ne=Math.max;var oe=K?function(t,e){return K(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:re,ie=800,ae=16,ce=Date.now;var se=function(t){var e=0,r=0;return function(){var n=ce(),o=ae-(n-r);if(r=n,o>0){if(++e>=ie)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(oe);function ue(t,e){return se(function(t,e,r){return e=ne(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=ne(n.length-e,0),a=Array(i);++o<i;)a[o]=n[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=n[o];return c[e]=r(a),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,c)}}(t,e,re),t+"")}var le,pe=(le=function(t,e,r){ee(t,e,r)},ue(function(t,e){var r=-1,n=e.length,i=n>1?e[n-1]:void 0,a=n>2?e[2]:void 0;for(i=le.length>3&&"function"==typeof i?(n--,i):void 0,a&&function(t,e,r){if(!k(r))return!1;var n=typeof e;return!!("number"==n?jt(r)&&Ht(e,r.length):"string"==n&&e in r)&&o(r[e],t)}(e[0],e[1],a)&&(i=n<3?void 0:i,n=1),t=Object(t);++r<n;){var c=e[r];c&&le(t,c,r,i)}return t})),fe="5.13.0".split(".")[0],de={local:{staticPath:"file:///Users/beauaugust/Documents/projects/evertise/audience-tracking/dist/",eventCollector:"https://europe-west2-tech-microservices-staging.cloudfunctions.net/batch-event-collector",offers:"https://staging-offers.igms.io/api/v1/"},staging:{staticPath:"https://static-staging.igms.io/audience-tracking/v"+fe+"/",eventCollector:"https://europe-west2-tech-microservices-staging.cloudfunctions.net/batch-event-collector",offers:"https://staging-offers.igms.io/api/v1/"},prod:{staticPath:"https://static.igms.io/audience-tracking/v"+fe+"/",eventCollector:"https://europe-west2-tech-microservices-production.cloudfunctions.net/batch-event-collector",offers:"https://offers.igms.io/api/v1/"}},be=function(t){var e=null;try{var r=new Blob(["importScripts('"+t+"');"],{type:"application/javascript"}),n=(window.URL||window.webkitURL).createObjectURL(r);e=new Worker(n)}catch(t){console.error(t)}return e},me=function(t){var e=t+"data-worker.js";return new Promise(function(t){var r,n,o,i=null;try{r=e,n=window.location,(o=document.createElement("a")).href=r,o.hostname===n.hostname&&o.port===n.port&&o.protocol===n.protocol?(i=new Worker(e)).onerror=function(t){t.preventDefault(),i=be(e)}:i=be(e)}catch(t){i=be(e)}t(i)})};var ge=t=>encodeURIComponent(t).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),ye=new RegExp("%[a-f0-9]{2}","gi"),he=new RegExp("(%[a-f0-9]{2})+","gi");function ve(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(1===t.length)return t;e=e||1;var r=t.slice(0,e),n=t.slice(e);return Array.prototype.concat.call([],ve(r),ve(n))}function xe(t){try{return decodeURIComponent(t)}catch(n){for(var e=t.match(ye),r=1;r<e.length;r++)e=(t=ve(e,r).join("")).match(ye);return t}}var ke=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},r=he.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch(t){var n=xe(r[0]);n!==r[0]&&(e[r[0]]=n)}r=he.exec(t)}e["%C2"]="�";for(var o=Object.keys(e),i=0;i<o.length;i++){var a=o[i];t=t.replace(new RegExp(a,"g"),e[a])}return t}(t)}},we=(t,e)=>{if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===e)return[t];const r=t.indexOf(e);return-1===r?[t]:[t.slice(0,r),t.slice(r+e.length)]},_e=function(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t,e){function r(t){if("string"!=typeof t||1!==t.length)throw new TypeError("arrayFormatSeparator must be single character string")}function n(t,e){return e.encode?e.strict?ge(t):encodeURIComponent(t):t}function o(t,e){return e.decode?ke(t):t}function i(t){const e=t.indexOf("#");return-1!==e&&(t=t.slice(0,e)),t}function a(t){const e=(t=i(t)).indexOf("?");return-1===e?"":t.slice(e+1)}function c(t,e){return e.parseNumbers&&!Number.isNaN(Number(t))&&"string"==typeof t&&""!==t.trim()?t=Number(t):!e.parseBooleans||null===t||"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(t="true"===t.toLowerCase()),t}function s(t,e){r((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const n=function(t){let e;switch(t.arrayFormat){case"index":return(t,r,n)=>{e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),e?(void 0===n[t]&&(n[t]={}),n[t][e[1]]=r):n[t]=r};case"bracket":return(t,r,n)=>{e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),e?void 0!==n[t]?n[t]=[].concat(n[t],r):n[t]=[r]:n[t]=r};case"comma":case"separator":return(e,r,n)=>{const i="string"==typeof r&&r.split("").indexOf(t.arrayFormatSeparator)>-1?r.split(t.arrayFormatSeparator).map(e=>o(e,t)):null===r?r:o(r,t);n[e]=i};default:return(t,e,r)=>{void 0!==r[t]?r[t]=[].concat(r[t],e):r[t]=e}}}(e),i=Object.create(null);if("string"!=typeof t)return i;if(!(t=t.trim().replace(/^[?#&]/,"")))return i;for(const r of t.split("&")){let[t,a]=we(e.decode?r.replace(/\+/g," "):r,"=");a=void 0===a?null:["comma","separator"].includes(e.arrayFormat)?a:o(a,e),n(o(t,e),a,i)}for(const t of Object.keys(i)){const r=i[t];if("object"==typeof r&&null!==r)for(const t of Object.keys(r))r[t]=c(r[t],e);else i[t]=c(r,e)}return!1===e.sort?i:(!0===e.sort?Object.keys(i).sort():Object.keys(i).sort(e.sort)).reduce((t,e)=>{const r=i[e];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?t[e]=function t(e){return Array.isArray(e)?e.sort():"object"==typeof e?t(Object.keys(e)).sort((t,e)=>Number(t)-Number(e)).map(t=>e[t]):e}(r):t[e]=r,t},Object.create(null))}e.extract=a,e.parse=s,e.stringify=((t,e)=>{if(!t)return"";r((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const o=r=>e.skipNull&&(t=>null==t)(t[r])||e.skipEmptyString&&""===t[r],i=function(t){switch(t.arrayFormat){case"index":return e=>(r,o)=>{const i=r.length;return void 0===o||t.skipNull&&null===o||t.skipEmptyString&&""===o?r:null===o?[...r,[n(e,t),"[",i,"]"].join("")]:[...r,[n(e,t),"[",n(i,t),"]=",n(o,t)].join("")]};case"bracket":return e=>(r,o)=>void 0===o||t.skipNull&&null===o||t.skipEmptyString&&""===o?r:null===o?[...r,[n(e,t),"[]"].join("")]:[...r,[n(e,t),"[]=",n(o,t)].join("")];case"comma":case"separator":return e=>(r,o)=>null==o||0===o.length?r:0===r.length?[[n(e,t),"=",n(o,t)].join("")]:[[r,n(o,t)].join(t.arrayFormatSeparator)];default:return e=>(r,o)=>void 0===o||t.skipNull&&null===o||t.skipEmptyString&&""===o?r:null===o?[...r,n(e,t)]:[...r,[n(e,t),"=",n(o,t)].join("")]}}(e),a={};for(const e of Object.keys(t))o(e)||(a[e]=t[e]);const c=Object.keys(a);return!1!==e.sort&&c.sort(e.sort),c.map(r=>{const o=t[r];return void 0===o?"":null===o?n(r,e):Array.isArray(o)?o.reduce(i(r),[]).join("&"):n(r,e)+"="+n(o,e)}).filter(t=>t.length>0).join("&")}),e.parseUrl=((t,e)=>{e=Object.assign({decode:!0},e);const[r,n]=we(t,"#");return Object.assign({url:r.split("?")[0]||"",query:s(a(t),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:o(n,e)}:{})}),e.stringifyUrl=((t,r)=>{r=Object.assign({encode:!0,strict:!0},r);const o=i(t.url).split("?")[0]||"",a=e.extract(t.url),c=e.parse(a,{sort:!1}),s=Object.assign(c,t.query);let u=e.stringify(s,r);u&&(u=`?${u}`);let l=function(t){let e="";const r=t.indexOf("#");return-1!==r&&(e=t.slice(r)),e}(t.url);return t.fragmentIdentifier&&(l=`#${n(t.fragmentIdentifier,r)}`),`${o}${u}${l}`})}),je=(_e.extract,_e.parse,_e.stringify,_e.parseUrl,_e.stringifyUrl,function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,t)}),Oe=function(t){var e=document.createElement("a");return e.href=t,e.hostname},Se=function(t){return _e.parse(t)},Ie=function(t,e){return Se(e&&e.search||window.location.search)[t]||null},Ee=function(t){return t.endsWith("/")?t.slice(0,-1):t},Ce=function(t){if(!t)return{};try{return JSON.parse(t)}catch(t){return{}}},Ae=function(){var t=localStorage.getItem("INV_ID");if(t)return t;var e="INV"+(Date.now().toString(36)+Math.random().toString(36).substr(2,12)).toUpperCase();return localStorage.setItem("INV_ID",e),e},Ue=function(t,e){var r,n,o=pe({},(r=t.pathname.split("fbr/")[1],{channel:(n=Ee(r).split("/"))[0],partner:n[1]}),{clickid:je(),pvid:e});t.rel="noopener nofollow",t.target="_blank",t.dataset.partnerData=JSON.stringify(o)},Pe=function(r,n,o){void 0===o&&(o=!0);var i=r.channel,a=r.clickid,c=r.coin,s=r.country,u=r.language,l=r.partner,p=r.pvid,f=r.state,d=r.stock,b=e(r,["channel","clickid","coin","country","language","partner","pvid","state","stock"]),m=document.documentElement.lang?document.documentElement.lang.substring(0,2).toLowerCase():"en",g=Object.entries(t(t({},b),{language:u||m,channel:i,coin:c,country:s,state:f,stock:d,clickid:a,pvid:p})).map(function(t){var e=t[0],r=t[1];return!!r&&e+"="+r}).filter(Boolean).join("&"),y=de[n].offers+"public",h=["/visit/",l,"?"+g].filter(Boolean).join("");return o?""+y+h:h},ze=function(r,n){return pe({},function(r){var n=Ee(r.pathname).split("/"),o=n[n.length-1],i=Se(r.search),a=i.channel,c=void 0===a?null:a,s=i.coin,u=void 0===s?null:s,l=i.component,p=void 0===l?null:l,f=i.country,d=void 0===f?null:f,b=i.language,m=void 0===b?null:b,g=i.position,y=void 0===g?null:g,h=i.state,v=void 0===h?null:h,x=i.totalPositions,k=void 0===x?null:x,w=e(i,["channel","coin","component","country","language","position","state","totalPositions"]);return t(t({},w),{channel:c,coin:u,component:p,country:d,language:m,position:y,state:v,totalPositions:k,partner:"visit"===o?null:o})}(r),{clickid:je(),pvid:n})},Fe=function(){var t=Ie("gclid")||Ie("adwordsid")||sessionStorage.getItem("gclid"),e=Ie("gclsrc")||sessionStorage.getItem("gclsrc");return e&&sessionStorage.setItem("gclsrc",e),!t||e&&-1===e.indexOf("aw")?null:(sessionStorage.setItem("gclid",t),t)},Le=function(){var t=Ie("msclkid")||sessionStorage.getItem("msclkid");return t?(sessionStorage.setItem("msclkid",t),t):null},Re=function(){var t=Ie("utm_medium")||sessionStorage.getItem("utm_medium"),e=Oe(document.referrer);return Fe()||Le()?t="cpc":(e.includes("google")||e.includes("bing")||document.referrer.includes("com.google.android.googlequicksearchbox"))&&(t="organic"),t&&"null"!==t?(sessionStorage.setItem("utm_medium",decodeURIComponent(t)),decodeURIComponent(t)):document.referrer?"referral":"direct"},Te=function(){var t=Ie("utm_term")||sessionStorage.getItem("utm_term"),e=Fe()||Le();if(e&&(t=e),t&&"null"!==t)return sessionStorage.setItem("utm_term",decodeURIComponent(t)),decodeURIComponent(t)},Ne=function(t){var e=Ie(t)||sessionStorage.getItem(t);if(e&&"null"!==e)return sessionStorage.setItem(t,decodeURIComponent(e)),decodeURIComponent(e)},qe={"10markets":"10markets","1billionforex":"1billionforex","1k-daily-profit":"1k-daily-profit","247-crypto-currencies":"247-cryptocurrencies","24fx":"24fx","24option":"24option","30k-challenge":"30-day-challenge","50kdollarsaweek":"50k-dollars-a-week","admiral-markets":"admiral-markets",aex:"aex",afx:"afx","alfa-financials":"alfa-financials","algo-signals":"algo-signals",alpari:"alpari-international",alvexo:"alvexo",amarkets:"amarkets","amazon-millionaires":"amazon-millionaires","aphria-trader":"aphria-trader","atc-brokers":"atc-brokers",atfx:"atfx",auroratrader:"aurora-trader",avatrade:"avatrade",axitrader:"axitrader",bdswiss:"bdswiss",bestcryptobroker:"best-crypto-broker","big-money-rush":"big-money-rush",bigone:"bigone",binance:"binance",binbotpro:"binbot-pro",binomo:"binomo","bit-Trader":"bittrader","bit-trader":"bittrader2",bitbay:"bitbay",bitclub:"bitclub","bitcoin-aussie-system":"bitcoin-aussie-system","bitcoin-billionaire":"bitcoin-billionaire","bitcoin-blueprint":"bitcoin-blueprint","bitcoin-boom":"bitcoin-boom","bitcoin-capital":"bitcoin-capital","bitcoin-cash-grab":"bitcoin-cash-grab","bitcoin-circuit":"bitcoin-circuit","bitcoin-code-expert":"bitcoin-code-expert","bitcoin-era":"bitcoin-era","bitcoin-evolution":"bitcoin-evolution","bitcoin-formula":"bitcoin-formula","bitcoin-fortune":"bitcoin-fortune","bitcoin-future":"bitcoin-future","bitcoin-hero":"bitcoin-hero","bitcoin-lifestyle":"bitcoin-lifestyle","bitcoin-millionaire":"bitcoin-millionaire","bitcoin-money":"bitcoin-money","bitcoin-pro":"bitcoin-pro","bitcoin-revival":"bitcoin-revival","bitcoin-rocket":"bitcoin-rocket","bitcoin-rush":"bitcoin-rush","bitcoin-secret":"bitcoin-secret","bitcoin-superstar":"bitcoin-superstar","bitcoin-time":"bitcoin-time","bitcoin-trade-robot":"bitcoin-trade-robot","bitcoin-wealth":"bitcoin-wealth",bitcoincode:"bitcoin-code",bitcoincompass:"bitcoin-compass",bitcoindecoder:"bitcoin-decoder",bitcoininvestor:"bitcoin-investor",bitcoinloophole:"bitcoin-loophole",bitcoinmethod:"bitcoin-method",bitcoinminer:"bitcoin-miner",bitcoinnewstrader:"bitcoin-news-trader",bitcoinprofit:"bitcoin-profit",bitcoinrevolution:"bitcoin-revolution","bitcoins-formula":"bitcoin-formula",bitcointrader:"bitcoin-trader",bitcointraderobot:"bitcoin-trade-robot",bitfinex:"bitfinex",bitflyer:"bitflyer",bithoven:"bithoven",bithumb:"bithumb",bitpanda:"bitpanda",bitso:"bitso",bitstamp:"bitstamp",bittrex:"bittrex",bitz:"bit-z",blackbull:"blackbull-markets",blockchain:"blockchain","blueberry-markets":"blueberry-markets","brexit-trader":"brexit-trader",btcrobot:"btc-robot",bxinth:"bx-in-th","cannabis-millionaire":"cannabis-millionaire","cannabis-software":"cannabis-software","cannabis-trader":"cannabis-trader","canuck-method":"canuck-method",capital:"capital-com","capital-index":"capital-index",centobot:"centobot",cex:"cex",changelly:"changelly",cityindex:"city-index","cmc-markets":"cmc-markets","cmc-markets-uk":"cmc-markets-uk","cms-forex":"cms-forex",cmstrader:"cmstrader",cobinhood:"cobinhood",coinall:"coinall",coinbase:"coinbase",coinbull:"coinbull",coincheck:"coincheck",coinexchange:"coinexchange",coinfloor:"coinfloor",coinmama:"coinmama",conquer:"conquer",consorsbank:"consors",copybuffett:"copy-buffett",crownsignals:"crown-signals","crypto-cash":"crypto-cash","crypto-comeback-pro":"crypto-comeback-pro","crypto-contracts":"crypto-contracts","crypto-engine":"crypto-engine","crypto-genius":"crypto-genius","crypto-hopper":"crypto-hopper","crypto-nation-pro":"crypto-nation-pro","crypto-revolt":"crypto-revolt","crypto-rise":"crypto-rise","crypto-robot":"crypto-robot","crypto-rocket":"crypto-rocket","crypto-vip-club":"crypto-vip-club","crypto-wealth":"crypto-wealth",cryptocode:"crypto-code",cryptofuture:"cryptofuture",cryptomethod:"crypto-method",cryptopia:"cryptopia",cryptorobot365:"cryptorobot365",cryptosoft:"cryptosoft",cryptotrader:"crypto-trader","dax-robot":"dax-robot",degiro:"degiro","direct-fx":"direct-fx",directsignals:"direct-signals",drexelcode:"drexel-code","dubai-partners":"dubai-profit-now",dubailifestyle:"dubai-lifestyle","eagle-fx":"eaglefx","easy-trade-app":"easy-trade-app",eightcap:"eightcap",elitetrading:"elite-trading",etfinance:"etfinance",ethereumcode:"ethereum-code",etoro:"etoro","etoro-us":"etoro",etoro_disclaimer:"etoro-disclaimer",etorox:"etorox",europefx:"europefx",fastbrokers:"fastbrokers",fbs:"fbs","fibo-group-holdings":"fibo-group-holdings",finmax:"finmax","finmax-br-ca":"finmax","finpro-trading":"finpro-trading","fintech-ltd":"fintech-ltd","forex-broker-inc":"forex-broker-inc","forex-club":"forex-club","forex-com":"forex-com","forex-corporate":"forex-corporate",forexmart:"forexmart",fortissio:"fortissio",foxbit:"foxbit","fp-markets":"fp-markets","fx-money-world":"fx-money-world","fx-trading-pro":"fx-trading-pro",fxcl:"fxcl",fxcm:"fxcm","fxfinpro-capital":"fxfinpro-capital","fxgm---fx-global-market":"fxgm","fxgm-za":"fxgm",fxiconic:"fxiconic",fxjet:"fxjet",fxplayer:"fxplayer",fxpro:"fxpro",fxtm:"fxtm",fxtrademarket:"fxtrademarket",fxvc:"fxvc","gain-capital-group":"gain-capital-group",gdax:"gdax-coinbase-pro",geldsmaschine:"geldsmaschine",gemini:"gemini",global:"etoro","global-prime-forex":"global-prime-forex","gmi---global-market-index":"gmi-global-market-index",gmotrading:"gmotrading","grand-fx-pro":"grand-fx-pro","green-gold":"green-gold",hitbtc:"hitbtc",hycm:"hycm",iamfx:"iamfx",ibamarkets:"ibamarkets","icm----itrade-capital-markets":"icm-itrade-capital-markets",icomoneymaker:"ico-money-maker","ig-markets":"ig-markets","ikon-global-markets":"ikon-global-markets",immediateedge:"immediate-edge",indacoin:"indacoins",instaforex:"instaforex","intent-trading-academy":"intent-trading-academy","interactive-brokers":"interactive-brokers","interactive-investor":"interactive-investor",investous:"investous",itrader:"itrader","juve-millionaires":"juve-millionaires",kraken:"kraken",kucoin:"kucoin",libertex:"libertex","libra-method":"libra-method","libra-profit-system":"libra-profit-system",liteforex:"liteforex",localbitcoins:"localbitcoins",lqdfx:"lqdfx",luno:"luno","markets-online":"markets-online",meritforex:"meritforex","millionaire-blueprint":"millionaire-blueprint",mintbrokers:"mintbroker","moneta-markets":"moneta-markets",monfex:"monfex",nadex:"nadex","naga-partners":"naga-markets",netflix:"netflix",nordfx:"nordfx",nsb:"nsbroker",oanda:"oanda",oinvest:"oinvest",olofx:"olofx","one-bitcoin-a-day":"one-bitcoin-a-day",onvista:"onvista","pattern-trader-bot":"pattern-trader-bot",paxforex:"paxforex",paxful:"paxful",pepperstone:"pepperstone",plus500:"plus500",poloniex:"poloniex",prestigefm:"prestige-fm","profit-formula":"profit-formula","pvp-markets-ltd":"pvp-markets-ltd","q8-trade":"q8-trade",quadrigacx:"quadrigacx","quantum-code":"quantum-code",rallytrade:"rallytrade","ripple-code":"ripple-code","saxo-bank":"saxo-markets","semantic-app":"semantic-app",shapeshift:"shapeshift","simple-registration":"simple-registration",skilling:"skilling","smartest-investor":"smartest-investor","storm-gain":"stormgain",stormgain:"stormgain","stratton-markets":"stratton-markets","svenska-formel":"svenska-formel",swissmethode:"swiss-methode","swissquote-bank":"swissquote-bank",tallinex:"tallinex","teletrade-europe":"teletrade-europe","teletrade-uae":"teletrade-uae",terafx:"terafx","tesler-app":"tesler-app","tfx-markets":"tfx-markets","the-aussie-method":"the-aussie-method","the-news-spy":"the-news-spy","the-stock-master":"the-stock-master",thinkmarkets:"thinkmarkets",trade360:"trade360",tradear:"tradear",tradeberry:"tradeberry",trademote:"trademote",traderschoicefx:"traderschoicefx","trading-robot":"trading-robot",tradize:"tradize",trymarkets:"trymarkets",ufx:"ufx","uniglobe-markets":"uniglobe-markets",uprofx:"uprofx","us-etoro":"etorox",vantagefx:"vantagefx","velocity-trade":"velocity-trade","wealth-matrix":"wealth-matrix","weed-millionaire":"weed-millionaire",wex:"wex",wirex:"wirex",worldmarkets:"world-markets","x-m":"xm-com",xcfd:"xcfd",xcoins:"xcoins",xtb:"xtb","xtb-uk":"xtb-uk",xtrade:"xtrade",yobit:"yobit",youtradefx:"youtradefx","zar-fx":"zar-fx",zebpay:"zebpay",zulutrade:"zulutrade"},Ve=function(t,e){return pe({},{type:"pageview",user:{ref:t},insertion:{writer:"audience-tracking"},pageView:{id:je(),userAgent:navigator.userAgent,source:{adgroupname:Ne("adgroupname"),gclid:Fe(),msclkid:Le(),referer:document.referrer,utmSource:(r=Ie("utm_source")||sessionStorage.getItem("utm_source")||Oe(document.referrer),r&&"null"!==r&&sessionStorage.setItem("utm_source",decodeURIComponent(r)),decodeURIComponent(r)),utmMedium:Re(),utmCampaign:Ne("utm_campaign"),utmTerm:Te(),utmContent:Ne("utm_content")},pageMeta:{language:document.documentElement.lang,path:window.location.pathname,title:document.title,uri:window.location.href,template:e},siteMeta:{hostname:window.location.hostname}}},{pageView:{pageMeta:{template:e}}});var r},Be=function(t,e,r,n){var o=r.partner,i=r.channel,a=r.coin,c=r.clickid,s=r.position,u=r.totalPositions,l=qe[o],p=(i||"crypto").toLowerCase(),f=l?[l,p].join("-"):o;return{type:"clickout",clickout:{id:c,type:e,component:{type:n,anchorText:t.innerText,table:{position:s,totalPositions:u}},visitLink:{raw:t.href,channel:p,coin:a&&a.toUpperCase()}},commercial:{funnel:f}}};return function(){function e(t,e){void 0===t&&(t="prod"),this.userId=Ae(),this.pageViewEvent=Ve(this.userId,e),this.bannerImpressions=this.getBannerImpressions(),this.env=t}return e.prototype.init=function(){return r(this,void 0,Promise,function(){var t=this;return n(this,function(e){return me(de[this.env].staticPath).then(function(t){window.dataWorker=t,window.dataWorker.onmessage=function(t){Ie("debug")&&console.log("Track Event:",t.data)}}).then(function(){t.track(function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n}([t.pageViewEvent],Object.values(t.bannerImpressions))),t.setupEventListeners(),t.setupBannerLinks(),t.setupVisitLinks()}),[2]})})},e.prototype.track=function(t){window.dataWorker?window.dataWorker.postMessage(JSON.parse(JSON.stringify([t,this.env]))):function(t,e){void 0===e&&(e="prod"),new Promise(function(r,n){var o=new XMLHttpRequest;o.open("POST",de[e].eventCollector),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status||304===o.status?r(o.responseText):n(o.responseText))},o.send(JSON.stringify({events:t}))})}(t,this.env)},e.prototype.trackBannerClickout=function(t,e){var r=e.dataset.uuid,n=Object.entries(this.bannerImpressions).find(function(t){return t[0]===r});if(n){var o=n[1];this.track([pe({},this.pageViewEvent,o,Be(t.target,"banner",{clickid:je()}))])}},e.prototype.trackClickout=function(t,e,r,n){void 0===r&&(r="visit-link"),this.emitTagManagerEvent(r+"-clickout"),this.track([pe({},this.pageViewEvent,Be(t.target,r,e,n))])},e.prototype.emitTagManagerEvent=function(e,r,n){window.dataLayer&&window.dataLayer.push(t(t({event:e},r),{eventCallback:n}))},e.prototype.getBannerImpressions=function(){var e=this;return Array.from(document.querySelectorAll("[data-ad-banner]")).reduce(function(r,n){var o,i=je();return n.dataset.uuid=i,t(t({},r),((o={})[i]=pe({},e.pageViewEvent,function(t){var e=t.creativeId,r=void 0===e?void 0:e,n=t.partner,o=void 0===n?void 0:n;return{type:"bannerImpression",bannerImpression:{id:r,filled:!!r,slot:t.slot},commercial:{partner:o}}}(Ce(n.dataset.adBanner))),o))},{})},e.prototype.setupEventListeners=function(){var t=this;document.body.addEventListener("click",this.onClick.bind(this)),document.body.addEventListener("contextmenu",this.onClick.bind(this)),document.body.addEventListener("auxclick",function(e){return 3!==e.which&&t.onClick(e)})},e.prototype.setupVisitLinks=function(){var t=this;Array.from(document.querySelectorAll("a[href *='/visit']")).forEach(function(e){e.dataset.partnerData||function(t,e,r){var n=ze(new URL(t.href),e);t.href=Pe(n,r,!0),t.rel="noopener nofollow",t.target="_blank",t.dataset.partnerData=JSON.stringify(n)}(e,t.pageViewEvent.pageView.id,t.env)})},e.prototype.setupBannerLinks=function(){var t=this;Array.from(document.querySelectorAll("a[href *='/fbr/']")).forEach(function(e){return Ue(e,t.pageViewEvent.pageView.id)})},e.prototype.onClick=function(t){var e=t.target;if("a"===e.tagName.toLowerCase()){if(e.href.includes("/visit/")){var r=(n=Ce(e.dataset.partnerData)).component||"in-content";return this.trackClickout(t,n,"visit-link",r)}if(e.href.includes("/fbr/")){var n=Ce(e.dataset.partnerData);return this.trackClickout(t,n,"api-form")}var o=e.closest("[data-ad-banner]");return o?this.trackBannerClickout(t,o):void 0}},e.prototype.trackFormSubmission=function(){return r(this,void 0,void 0,function(){var t,e=this;return n(this,function(r){return t="api-form-registration",[2,new Promise(function(r,n){if(!window.dataLayer)return n({message:"dataLayer doesn't exist. Has GTM been set up?"});e.emitTagManagerEvent(t,{},function(){return r(t)})})]})})},e.prototype.getVisitLinkUrl=function(t,e){return void 0===e&&(e=!1),Pe(t,this.env,e)},e.prototype.generateDataFromVisitLink=function(t){var e=ze(new URL(t),this.pageViewEvent.pageView.id);return{partnerData:e,url:Pe(e,this.env)}},e}()});
